# Reproducible Research: Peer Assessment 1


## Loading and preprocessing the data
Download the zipped data file from the web and store it in the current directory. 
Once the zipped file is in the local directory, we load it using the unz command. 

We also convert the date column to a valid date format, pre-processing also involves 
removing NA values

```{r, echo=TRUE}

if(!file.exists("activity.zip")){
        fileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
        download.file(fileUrl, destfile="activity.zip", meth="curl")
        dateDownloadtrain <- data()
}

data <- read.table(unz("activity.zip", "activity.csv"), 
                   header=T, quote="\"", sep=",")

data <- transform(data, date = as.Date(as.character(date, "%Y%m%d")))

#also remove NA values
Data <- subset(data,complete.cases(data)==TRUE)    

```

## What is mean total number of steps taken per day?
```{r, echo=TRUE}

# split the data by date and count in dailySteps 
# count the number of steps for each day
StepsPerday<-sapply(split(Data,Data$date, drop=TRUE) 
                   , function(x) sum(x$steps)) 
# plot the histogram
hist(StepsPerday, main="Histogram of Total Steps per Day", xlab="Number of Steps", col="gray") 
# Add the median and the mean on the plot! 
text(mean(StepsPerday),25,labels= paste("mean: ", round(mean(StepsPerday), 3)), , pos=4, col="blue")
text(median(StepsPerday),22,labels= paste("median: ", median(StepsPerday)), , pos=4, col="blue")
rug(StepsPerday, col="blue")
```

Following are the <b>mean</b> and the <b>median</b> of the total number of steps per day. 

```{r, echo=TRUE}

summary(StepsPerday)
```

## What is the average daily activity pattern?

Time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis).

```{r, echo=TRUE}

# split the data by interval and count in dailySteps 
# count the number of steps for each day
StepsPerIntervals<-sapply(split(Data,Data$interval, drop=TRUE) 
                   , function(x) mean(x$steps)) 

plot(StepsPerIntervals, type="l", main = "Daily Average Activity Pattern",
     ylab = "Average Number of steps", xlab = "Intervals", col = "red")
        abline(v=which.max(StepsPerIntervals), lty=3, col="blue") 
        text(which.max(StepsPerIntervals),max(StepsPerIntervals),  
     labels=paste("maximum = ",as.character(round(max(StepsPerIntervals)))), 
     pos=4, col="blue")


```

Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps? 

As shown in the code bellow, it is nterval whose name is <b>835</b>, its average number of steps is <b>206</b>, and that interval is the <b>104 th</b> interval . 


```{r, echo=TRUE}
names(which.max(StepsPerIntervals))  

round(max(StepsPerIntervals))

which.max(StepsPerIntervals)
```

## Imputing missing values

Total number of missing values in the dataset (i.e. the total number of rows with NAs): <b>2304</b>

```{r, echo=TRUE}

allData <- complete.cases(data)
number.missingVals <- length(allData[allData == FALSE])

number.missingVals
```

To impute missing values, let us use the mean across all days for the 5-minute interval which the NA occurs.

```{r, echo=TRUE}

# A new data set with an extra column, indicating whether a given 
# record is complete
rawData <- complete.cases(data)
data.combined <- cbind(data, rawData)

# split by rawData
splitNewData <- split(data.combined, data.combined$rawData, drop=TRUE)

# Now for each row in the split data wher rawDatais FALSE
# replace NA with the interval average 
# 

for (row in 1:nrow(splitNewData[["FALSE"]])){  
    splitNewData[["FALSE"]][row,1] <- round(subset(StepsPerIntervals,names(StepsPerIntervals) ==
                                     as.character(splitNewData[["FALSE"]][row,3])))
}

# splitNewData is a list that contains two data frames named respectively, TRUE 
# and FALSE. The false data frame contains imputed average number of steps for the missing 5 
# interval.
# The TRUE data frame contains the original data

# Put the data back in chronologcal order
newData <- rbind(splitNewData[["FALSE"]],splitNewData[["TRUE"]])
newData <- newData[with(newData, order(date, interval)), ]   

head(newData)
# Imputation done
```


Histogram of the total number of steps taken each day and Calculate and report the mean and median total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? 

```{r, echo=TRUE}

# split the data by date and count in dailySteps 
# count the number of steps for each day
StepsPerday<-sapply(split(newData,newData$date, drop=TRUE) 
                   , function(x) sum(x$steps)) 
# plot the histogram
hist(StepsPerday, main="New Histogram of Total Steps per Day", xlab="Number of Steps", col="gray") 
# Add the median and the mean on the plot! 
text(mean(StepsPerday),25,labels= paste("mean: ", round(mean(StepsPerday), 3)), , pos=4, col="blue")
text(median(StepsPerday),22,labels= paste("median: ", median(StepsPerday)), , pos=4, col="blue")
rug(StepsPerday, col="blue")
```

The mean and the median remain the same while quartiles vary slightly.

```{r, echo=TRUE}
summary(StepsPerday)
```

Impact of imputing missing data on the estimates of the total daily number of steps!
The main difference is in the number of observations for the center bar in the histogram (recall that the median and the mean where nearly the same).

```{r, echo=TRUE}

par(mfrow=c(1,2))


StepsPerday<-sapply(split(Data,Data$date, drop=TRUE) 
                   , function(x) sum(x$steps)) 
# plot the histogram
hist(StepsPerday, main="Histogram of Total Steps per Day", xlab="Number of Steps", col="gray", ylim=c(0,35)) 
# Add the median and the mean on the plot! 
text(mean(StepsPerday),25,labels= paste("mean: ", round(mean(StepsPerday), 3)), , pos=4, col="blue")
text(median(StepsPerday),22,labels= paste("median: ", median(StepsPerday)), , pos=4, col="blue")
rug(StepsPerday, col="blue")




StepsPerday<-sapply(split(newData,newData$date, drop=TRUE) 
                   , function(x) sum(x$steps)) 
# plot the histogram
hist(StepsPerday, main="New Histogram of Total Steps per Day", xlab="Number of Steps", col="gray") 
# Add the median and the mean on the plot! 
text(mean(StepsPerday),35,labels= paste("mean: ", round(mean(StepsPerday), 3)), , pos=4, col="blue")
text(median(StepsPerday),32,labels= paste("median: ", median(StepsPerday)), , pos=4, col="blue")
rug(StepsPerday, col="blue")


```


## Are there differences in activity patterns between weekdays and weekends?


Let us create a new factor variable in the dataset with two levels – “weekday” and “weekend” indicating whether a given date is a weekday or weekend day.


```{r, echo=TRUE}
newData$date <- as.Date(strptime(newData$date, format="%Y-%m-%d"))
# 'day' factor that holds  weekday / weekend  
newData$day <- weekdays(newData$date)                              
for (i in 1:nrow(newData)) {                                        
    if (newData[i,]$day %in% c("Saturday","Sunday")) {             
        newData[i,]$day<-"weekend"                                
    }
    else{
        newData[i,]$day<-"weekday"       #weekday                         
    }
}


## aggregate newData by steps as a function of interval + day  
stepsByDay <- aggregate(newData$steps ~ newData$interval + newData$day, newData, mean)

## reset the column names to be pretty & clean
names(stepsByDay) <- c("interval", "day", "steps")

par(mfrow=c(1,1))

require(lattice)

StepsPerIntervals<-sapply(split(newData,newData$interval, drop=TRUE) 
                   , function(x) mean(x$steps)) 

xyplot(steps ~ interval | day,  layout = c(1, 2), data=stepsByDay, 
       prepanel = function(x, y) prepanel.loess(x, y, span = 1),
       ylab = "Number of steps", xlab = "Interval", type="l",
       panel= function(x,y, ...){
        panel.xyplot(x, y, ...)
})



```


